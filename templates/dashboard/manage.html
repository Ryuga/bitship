{% extends 'dashboard/layouts/base.html' %}

{% block title %} Profile {% endblock title %}

{% block content %}

{% load custom %}

    <!-- Header -->
    <div class="header pb-8 pt-5 pt-lg-8 d-flex align-items-center"
      <!-- Mask -->
      <span class="mask bg-gradient-success opacity-8"></span>
      <!-- Header container -->
      <div class="container-fluid align-items-center">
        <div class="row">
          <div class="col-lg-7 col-md-10">
            <h1 class="text-white">{{ app.name }}</h1>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid mt--7">
      <div class="row">
        <div class="col-xl-12 order-xl-1">
          <div class="card bg-secondary shadow">
            <div class="card-header bg-white border-0">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">App management console</h3>
                </div>
              </div>
            </div>
            <div class="card-body" id="refreshSection">
                {% include 'dashboard/filesection.html' %}
            </div>
          </div>
        </div>
      </div>
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Add items</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="app-launch" enctype="multipart/form-data" method="post" action="{% url 'browse' app_id=app.id folder_id=folder.id %}">
                    {% csrf_token %}
                  <div class="form-row">
                    <label for="stack">Create new folder </label>
                    <div class="input-group mb-3">
                      <input type="text" class="form-control" name="folder" placeholder="Name of your folder" aria-label="Name of your folder" aria-describedby="basic-addon2">
                      <input type="hidden" value="{{ folder.id }}" name="master">
                      <input type="hidden" value="{{ app.id }}" name="app_id">
                      <div class="input-group-append">
                        <button class="btn btn-primary folderButton">Create</button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="fileModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Add items</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="app-launch" enctype="multipart/form-data" method="post" action="{% url 'browse' app_id=app.id folder_id=folder.id %}">
                    {% csrf_token %}
                  <div class="form-row">
                    <div class="input-group mb-3">
                      <div class="custom-file">
                        <input type="hidden" value="{{ folder.id }}" name="master">
                        <input type="hidden" value="{{ app.id }}" name="file_app_id">
                        <input type="file" class="custom-file-input" name="files_to_upload" id="file_upload" multiple>
                        <label class="custom-file-label" for="inputGroupFile02">Choose file</label>
                      </div>
                      <div class="input-group-append">
                        <button class="input-group-text btn btn-primary fileButton" id="">Upload</button>
                      </div>
                    </div>
                  </div>
                </form>
                <div class="col-sm-12 align-content-center">
                    <div id="progress-wrp"><div class="progress-bar"></div ><div class="status">0%</div></div>
                    <div id="output"><!-- error or success results --></div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="deleteModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Delete item</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                  Are you sure you want to delete <span id="itemName"></span>?<br>This action cannot be undone unless deploy backups are turned on.
              </div>
              <div class="modal-footer">
                <input type="hidden" id="folder_id" name="folder_id" value="">
                <input type="hidden" name="file_id" id="file_id" value="">
                <button type="button" class="btn btn-primary deleteButton">Delete</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
    <!--File rename model -->
        <div class="modal fade" id="renameFileModal" tabindex="-1" role="dialog" aria-labelledby="renameFileModal" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="renameFileModalTitle">Rename file</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="file-rename">
                    {% csrf_token %}
                  <div class="form-row">
                    <div class="input-group mb-3">
                      <input type="text" class="form-control" name="rename_file" placeholder="Enter new name" aria-label="Name of your folder" id="newFileName" aria-describedby="basic-addon2">
                      <input type="hidden" id="renameFileId">
                      <div class="input-group-append">
                        <button class="btn btn-primary renameFileButton">Rename</button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
        <!--File rename model end-->

{#        <!--Folder rename model -->#}
{#        <div class="modal fade" id="renameFolderModal" tabindex="-1" role="dialog" aria-labelledby="renameFolderModal" aria-hidden="true">#}
{#          <div class="modal-dialog modal-dialog-centered" role="document">#}
{#            <div class="modal-content">#}
{#              <div class="modal-header">#}
{#                <h5 class="modal-title" id="renameFolderModalTitle">Rename folder</h5>#}
{#                <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
{#                  <span aria-hidden="true">&times;</span>#}
{#                </button>#}
{#              </div>#}
{#              <div class="modal-body">#}
{#                <form id="folder-rename">#}
{#                    {% csrf_token %}#}
{#                  <div class="form-row">#}
{#                    <div class="input-group mb-3">#}
{#                      <input type="text" class="form-control" name="rename_folder" placeholder="Enter new name" aria-label="Name of your folder" id="renameFolderName" aria-describedby="basic-addon2">#}
{#                      <input type="hidden" id="renameFolderId">#}
{#                      <div class="input-group-append">#}
{#                        <button class="btn btn-primary renameFolderButton">Rename</button>#}
{#                      </div>#}
{#                    </div>#}
{#                  </div>#}
{#                </form>#}
{#              </div>#}
{#              <div class="modal-footer">#}
{#                <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#        </div>#}
{#        <!--Folder rename model end-->#}

    <!-- App configuration modal -->
      <div class="modal fade" id="pythonAppConfigurationModal" tabindex="-1" role="dialog" aria-labelledby="pythonAppConfigurationModal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="pythonAppConfigurationModalTitle">Configure your app</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="file-rename">
                <div class="form-row">
                    <div class="form-group col-md-6">
                      <label class="my-1 mr-2" for="pythonVersionSelectPref">Python version</label><br>
                      <select class="custom-select custom-select-sm my-1 mr-sm-2 col-md-6" id="pythonVersionSelectPref">
                        <option selected>Choose...</option>
                         {% for item in app.config_options.python_versions %}
                            <option value="{{ item }}">Python {{ item }}</option>
                         {% endfor %}
                      </select>
                    </div>
                    <div class="form-group col-md-3">
                      <label class="my-1 mr-2" for="appMainSelect">Select main file</label>
                      <select class="custom-select custom-select-sm my-1 mr-sm-2" id="appMainSelect">
                        <option selected>Choose...</option>
                        {% for file in app.primary_files %}
                            <option value="{{ file.pk }}">{{ file.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="savePythonConfigurationButton">Save</button>
            </div>
          </div>
        </div>
      </div>
    <!--App configuration model end-->
        <script>
            function setFileName(x,y) {
                    document.getElementById("itemName").textContent = x;
                    document.getElementById("file_id").value = y;
                    document.getElementById("folder_id").value = "";
            }
            function setFolderName(x,y) {
                    document.getElementById("itemName").textContent = x;
                    document.getElementById("folder_id").value = y;
                    document.getElementById("file_id").value = "";
            }
            function setFolderId(x){
                document.getElementById("renameFolderId").value=x;
            }
            function setFileId(x){
                document.getElementById("renameFileId").value=x;
            }
        </script>
      {% include "dashboard/includes/footer.html" %}

    </div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}{% endblock javascripts %}
